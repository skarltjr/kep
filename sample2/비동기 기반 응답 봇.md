# agit-event-bot
- 비동기 기반 아지트 글/댓글 생성 이벤트 응답 봇

### 1. 기존 문제점
```
1. 아지트 글/ 댓글 생성 이벤트 발생 ( 애플리케이션에게 post request )
2. 애플리케이션 내부에서 글 / 댓글 중 어떤 이벤트인지 파싱
3. ex) 글 생성 이벤트를 전달받은경우 "글 생성 이벤트 응답 댓글입니다~"를 작성하도록 agit에 post request 
4. 3번 요청 응답이 200이면 정상반환 / 그 외 4xx 5xx면 애플리케이션 또한 정상응답 반환 실패 


문제점 : 
애플리케이션이 agit에 강하게 결합되어있다.
-> 응답속도 영향
-> agit 장애가 그대로 애플리케이션에 전달
```

### 2. 해결 방향
- <img width="915" alt="스크린샷 2022-06-17 오후 5 02 51" src="https://user-images.githubusercontent.com/62214428/174508790-04661dec-be2b-4af7-9337-9dc246108ef0.png">

```
- 비동기 처리
0. agit로부터 글/댓글 생성 이벤트를 전달받고 즉시 응답( +응답용 댓글 생성 성공여부를 확인할 수 있는 url포함)
1. 응답 댓글 생성 요청을 하나의 task로 다룬다
2. redis가 task를 저장
3. redis는 워커인 celery에게 task를 전달
4. celery는 task 수행
```
### 3. workflow!
- ![Untitled Diagram drawio](https://user-images.githubusercontent.com/62214428/174508822-6e1ce636-1d11-468b-9a37-32648bdd8022.png)


### 4. 개선
```
1. 응답속도 약 1초에서 -> 2xx ms
2. agit로부터 응답 댓글 생성 요청에 대한 응답이 200이 아닌 다른 응답이 와도 애플리케이션에 영향 x
```

