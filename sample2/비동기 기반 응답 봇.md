# agit-event-bot
- 비동기 기반 아지트 글/댓글 생성 이벤트 응답 봇

### 1. 기존 문제점
```
1. 아지트 글/ 댓글 생성 이벤트 발생 ( 애플리케이션에게 post request )
2. 애플리케이션 내부에서 글 / 댓글 중 어떤 이벤트인지 파싱
3. ex) 글 생성 이벤트를 전달받은경우 "글 생성 이벤트 응답 댓글입니다~"를 작성하도록 agit에 post request 
4. 3번 요청 응답이 200이면 정상반환 / 그 외 4xx 5xx면 애플리케이션 또한 정상응답 반환 실패 


문제점 : 
애플리케이션이 agit에 강하게 결합되어있다.
-> 응답속도 영향
-> agit 장애가 그대로 애플리케이션에 전달
```

### 2. 해결 방향
- <img width="915" alt="스크린샷 2022-06-17 오후 5 02 51" src="https://user-images.githubusercontent.com/62214428/174508790-04661dec-be2b-4af7-9337-9dc246108ef0.png">

```
원인 : 애플리케이션과 외부 시스템의 강한 결합
해결 방법 : 
- 외부 시스템 호출을 별도의 task로 다루고 이를 비동기로 수행

호출 시점과 응답 시점이 다른 비동기 방식을 활용한다면 외부 서비스로 인한 응답 시간 지연을 해결할 수 있으며
celery 라이브러리를 활용하여 외부 서비스 호출 작업을 별도의 task로 다룸으로써 외부 서비스 장애 발생 시
task의 상태에 따라 로그를 기록하는 등 요청에 대한 응답 과정에 영향을 주지 않으면서 별도의 처리가 가능

(기존에는 애플리케이션에서 아지트 요청이 불가능하면 애플리케이션이 영향을 받았지만 이를 하나의 task로 다룸으로써 아지트의 장애로 인한 댓글 생성 실패를 한 task의 장애로 축소 
-> celery는 task의 상태를 SUCCESS,FAILURE, PENDING등의 상태에 따른 유연한 처리가 가능)
```
### 3. workflow!
- ![Untitled Diagram drawio](https://user-images.githubusercontent.com/62214428/174508822-6e1ce636-1d11-468b-9a37-32648bdd8022.png)


### 4. 개선
```
1. 응답속도 약 1초에서 -> 2xx ms
2. agit로부터 응답 댓글 생성 요청에 대한 응답이 200이 아닌 다른 응답이 와도 애플리케이션에 영향 x 동시에 task 상태에 따른 유연한 처리 가능
```

